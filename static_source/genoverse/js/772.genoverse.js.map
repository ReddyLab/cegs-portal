{"version":3,"file":"772.genoverse.js","mappings":"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","sources":["webpack://genoverse/./src/js/plugins/karyotype.js"],"sourcesContent":["import '../../css/karyotype.css';\nimport Chromosome from '../Track/library/Chromosome';\n\nconst plugin = function (pluginConf) {\n  const jQuery = this.jQuery;\n\n  function createKaryotype() {\n    const chromosome   = jQuery('<div class=\"gv-chromosome\">');\n    const container    = jQuery('<div class=\"gv-karyotype-container\">').html(chromosome).insertBefore(this.wrapper);\n    const assemblyName = this.assembly || this.genomeName;\n    const name         = `${pluginConf.showAssembly && assemblyName ? `${assemblyName}: ` : ''}Chr ${this.chr}`;\n\n    if (pluginConf.showAssembly && assemblyName) {\n      container.addClass('gv-show-assembly');\n    }\n\n    const measureWidth = jQuery(`<div class=\"gv-chromosome\"><ul class=\"gv-label-container\"><li><span class=\"gv-name\">${name}</span></li></ul></div>`).appendTo(container);\n    const labelWidth   = pluginConf.karyotypeLabel === false ? 0 : measureWidth.find('.gv-name').outerWidth(true) + 10;\n\n    measureWidth.remove();\n\n    this.karyotype = new Genoverse({\n      parent    : this,\n      container : chromosome,\n      width     : chromosome.width(),\n      genome    : this.genome,\n      chr       : this.chr,\n      start     : 1,\n      end       : this.chromosomeSize,\n      isStatic  : true,\n      tracks    : [\n        Chromosome.extend({\n          name          : name,\n          height        : 20,\n          featureHeight : 20,\n          border        : false,\n          legend        : false,\n          unsortable    : true,\n\n          click: function (e) {\n            const offset = this.container.parent().offset().left;\n            const x      = e.pageX - offset;\n            const f      = this.featurePositions.search({ x: x, y: 1, w: 1, h: 1 })[0];\n\n            if (f) {\n              if (e.type === 'mouseup') {\n                if (!this.browser.parent.isStatic) {\n                  this.browser.parent.moveTo(f.chr, f.start, f.end, true);\n                }\n              } else if (this.hoverFeature !== f && !this.browser.hideTooltip) {\n                this.container.tipsy('hide');\n\n                if (f.label) {\n                  const left = offset + f.position[this.scale].start + f.position[this.scale].width / 2;\n\n                  this.container.attr('title', f.label[0]).tipsy({ trigger: 'manual', container: 'body' }).tipsy('show').data('tipsy').$tip.css('left', function () { return left - jQuery(this).width() / 2; });\n                }\n\n                this.hoverFeature = f;\n              }\n            }\n          },\n\n          addUserEventHandlers: function () {\n            const track = this;\n\n            this.base();\n\n            this.container.on({\n              mousemove : (e) => { track.click(e); },\n              mouseout  : (e) => {\n                if (track.browser.viewPoint.is(e.relatedTarget) || track.browser.viewPoint.find(e.relatedTarget).length) {\n                  return true;\n                }\n\n                track.container.tipsy('hide');\n                track.hoverFeature = false;\n              },\n            }, '.gv-image-container');\n\n            // Don't allow zooming in and out on the karyotype image\n            this.container.on('mousewheel', '.gv-image-container, .gv-selector', (e) => {\n              e.stopPropagation();\n            });\n          },\n\n          afterSetName: function () {\n            this.label.css('lineHeight', `${this.label.height()}px`);\n          },\n        }),\n      ],\n\n      addUserEventHandlers: () => {},\n\n      afterInit: function () {\n        this.updatePosition();\n        this.viewPoint.fadeIn();\n      },\n\n      afterAddTracks: function () {\n        this.track = this.tracks[0];\n      },\n\n      afterAddDomElements: function () {\n        const karyotype = this;\n        const parent    = this.parent;\n\n        function hideTooltip() {\n          karyotype.hideTooltip = true;\n          karyotype.track.prop('container').tipsy('hide');\n        }\n\n        function updateLocation(e, ui) {\n          karyotype.hideTooltip = false;\n\n          const scale = karyotype.chromosomeSize / karyotype.width;\n          const axis  = e.type === 'resizestop' ? jQuery(this).data('ui-resizable').axis : undefined;\n          const start = axis === 'e' ? parent.start : Math.max(Math.floor(ui.position.left * scale), 1);\n          const end   = axis === 'w' ? parent.end   : e.type === 'dragstop' ? start + parent.length - 1 : Math.floor(ui.helper.outerWidth(true) * scale) + start;\n\n          if (start !== parent.start || end !== parent.end) {\n            parent.moveTo(karyotype.chr, start, end, true, e.type === 'dragstop');\n          }\n        }\n\n        if (pluginConf.karyotypeLabel === false) {\n          this.labelContainer.remove();\n          this.labelContainer = jQuery();\n          container.addClass('gv-no-label');\n        } else {\n          this.labelContainer.width(labelWidth);\n        }\n\n        this.viewPoint = jQuery('<div class=\"gv-karyotype-viewpoint-wrapper\"><div class=\"gv-karyotype-viewpoint\"></div></div>').appendTo(container).css({\n          left  : labelWidth,\n          width : this.width - labelWidth,\n        }).children().on({\n          mousemove : (e) => { karyotype.track.controller.click(e); },\n          mouseout  : (e) => {\n            const el = jQuery(e.relatedTarget);\n\n            if (karyotype.viewPoint.is(el) || karyotype.viewPoint.find(el).length || (el.prop('nodeName') === 'IMG' && el.parent().is(karyotype.track.prop('imgContainers')[0]))) {\n              return true;\n            }\n\n            karyotype.track.prop('container').tipsy('hide');\n            karyotype.track.prop('hoverFeature', false);\n          },\n        });\n\n        if (!parent.isStatic) {\n          this.viewPoint.draggable({\n            axis        : 'x',\n            containment : this.wrapper,\n            start       : hideTooltip,\n            stop        : updateLocation,\n          }).resizable({\n            handles     : 'e, w',\n            containment : 'parent',\n            start       : hideTooltip,\n            stop        : updateLocation,\n            resize      : function (e, ui) {\n              ui.element.css('left', Math.max(0, ui.position.left));\n\n              if (ui.position.left > 0) {\n                ui.element.width(Math.min(ui.size.width, ui.element.parent().width() - ui.position.left));\n              } else {\n                ui.element.width(ui.size.width + ui.position.left);\n              }\n            },\n          });\n        }\n      },\n\n      updatePosition: function () {\n        const left  =  this.parent.start * this.scale;\n        const width = (this.parent.end   * this.scale) - left;\n\n        this.viewPoint.css({ left: left, width: width });\n      },\n    });\n\n    if (this.loadedPlugins.controlPanel !== true) {\n      jQuery('<li class=\"gv-unsortable\">').height((i, h) => h + container.height()).prependTo(this.labelContainer);\n    }\n  }\n\n  function recreateKaryotype() {\n    const container = this.karyotype.container.parent();\n\n    this.karyotype.destroy();\n    container.remove();\n\n    createKaryotype.call(this);\n  }\n\n  this.on({\n    afterInit: createKaryotype,\n\n    afterSetRange: function () {\n      if (this.karyotype) {\n        this.karyotype.updatePosition();\n      }\n    },\n\n    afterSetWidth: recreateKaryotype,\n\n    afterMoveTo: function (chr) {\n      if (this.karyotype && this.karyotype.chr !== chr) {\n        recreateKaryotype.call(this);\n      }\n    },\n  });\n};\n\nexport default { karyotype: plugin };\n"],"names":["karyotype","pluginConf","jQuery","this","createKaryotype","chromosome","container","html","insertBefore","wrapper","assemblyName","assembly","genomeName","name","showAssembly","chr","addClass","measureWidth","appendTo","labelWidth","karyotypeLabel","find","outerWidth","remove","Genoverse","parent","width","genome","start","end","chromosomeSize","isStatic","tracks","height","featureHeight","border","legend","unsortable","click","e","offset","left","x","pageX","f","featurePositions","search","y","w","h","type","browser","moveTo","hoverFeature","hideTooltip","tipsy","label","position","scale","attr","trigger","data","$tip","css","addUserEventHandlers","track","base","on","mousemove","mouseout","viewPoint","is","relatedTarget","length","stopPropagation","afterSetName","afterInit","updatePosition","fadeIn","afterAddTracks","afterAddDomElements","prop","updateLocation","ui","axis","undefined","Math","max","floor","helper","labelContainer","children","controller","el","draggable","containment","stop","resizable","handles","resize","element","min","size","loadedPlugins","controlPanel","i","prependTo","recreateKaryotype","destroy","call","afterSetRange","afterSetWidth","afterMoveTo"],"sourceRoot":""}
