{% extends "base.html" %}
{% load static i18n %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<link href="{% static 'css/nouislider.min.css' %}" rel="stylesheet" />
<!-- This CSS modifies the range slider look -->
<style>
    .noUi-horizontal {
        height: 10px;
    }

    .noUi-horizontal .noUi-handle {
        width: 20px;
        height: 20px;
    }

    .noUi-handle {
        border-radius: 10px;
    }

    .noUi-handle:before,
    .noUi-handle:after {
        display: none;
    }

    .noUi-connect {
        background: rgba(1, 33, 105, 1);
    }

    .noUi-pips-horizontal {
        transform: translate(6px);
    }

    select {
        font-size: 0.9rem;
        padding: 5px 5px;
    }

</style>
{% endblock %}

{% block javascript %}
{{ block.super }}
<script type="text/javascript" src="{% static 'js/nouislider.min.js' %}"></script>
<script type="text/javascript" src="{% static 'search/js/exp_viz/vizUtils.js' %}"></script>
<script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock %}

{% block title %}Experiments{% endblock %}

{% block content %}
<div>
    <div class="container">
        <ul>
            {% for expr in experiments %}
            <li>{{ expr.name }}</li>
            {% endfor %}
        </ul>
    </div>
</div>
<div class="min-w-full">
    <div
        id="coverage"
    >
        <div class="flex flex-row gap-x-10">
            <div id="chrom-data-filters" class="basis-1/4">
                <!-- content section container for facet side bar -->
                <div class="facet-content-section container">
                    <div class="text-slate-500">
                        <span id="chrom-data-header" class="text-xl font-bold"></span
                        ><span class="bi bi-layers-half" style="margin-left: 0.5em"></span>
                    </div>
                    <div class="title-separator"></div>
                    <div id="chrom-data-categorical-facets"></div>
                    <div id="chrom-data-numeric-facets"></div>
                    <div id="chrom-data-counts"></div>
                </div>

                <div class="facet-content-section container">
                    <form name="regionUploadForm">
                        <div>
                            <label class="font-bold" for="regionFile">Highlight Regions</label>
                            <input id="regionUploadInput" type="file" accept=".bed" name="regionFile" />
                        </div>
                    </form>
                    <div id="regionUploadInputReset"></div>
                </div>

                {% if logged_in %}
                <div class="facet-content-section container">
                    <form name="dataDownloadForm">
                        <div>
                            <label class="font-bold" for="dataDlAll">Download All Selected Data*</label>
                            <div><input id="dataDownloadAll" type="button" name="dataDlAll" value="Request Data" /></div>
                        </div>
                        <div class="mt-5">
                            <label class="font-bold" for="dataDlFile">Download Some Selected Data*</label>
                            <input id="dataDownloadInput" type="file" accept=".bed" name="dataDlFile" />
                        </div>
                    </form>
                    <div id="dataDownloadLink" class="mt-5 mb-5"></div>
                    <div>
                    * Data downloads take facet filtering, except for "Number of {{ experiment.get_source_type_display }}s" and "Number of Genes Assayed", into account.
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="basis-3/4 container">
                <!-- content section container for ChromCov -->
                <div class="flex flex-row gap-x-4 items-center">
                    <div id="chrom-data-legend"></div>
                    <div class="flex flex-col">
                        <div id="reo-count"></div>
                        <div id="source-count"></div>
                        <div id="target-count"></div>
                    </div>
                    <div>
                        <label for="covSelect">Choose a Coverage View:</label>
                        <select name="views" id="covSelect">
                            <option value="sig">Largest Significance</option>
                            <option value="effect">Greatest Effect Size</option>
                            <option value="count">Gene Count</option>
                        </select>
                    </div>
                </div>
                <div id="chrom-data"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block inline_javascript %}
{{ experiment_viz|json_script:"experiment_viz" }}
<script type="module">
    import {combined_viz} from "{% static 'search/js/exp_viz/combo_viz.js' %}";
    combined_viz("{% get_static_prefix %}", "{{ csrf_token }}", "{{ logged_in }}" == "True");
</script>
{% endblock %}
