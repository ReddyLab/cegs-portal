{% load humanize %}
{% load custom_helpers %}


<div class="table-title" style="display: flex; align-items: center; justify-content: space-between; position: relative;">
    <div style="display: flex; align-items: center; justify-content: center; flex-grow: 1;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-icon mr-1">
            <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            <path
                d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM241 119c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l31 31H120c-13.3 0-24 10.7-24 24s10.7 24 24 24H238.1l-31 31c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l72-72c9.4-9.4 9.4-24.6 0-33.9l-72-72z"
            />
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-icon mr-2 rotate-90">
            <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            <path
                d="M24 32C10.7 32 0 42.7 0 56V456c0 13.3 10.7 24 24 24H40c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24H24zm88 0c-8.8 0-16 7.2-16 16V464c0 8.8 7.2 16 16 16s16-7.2 16-16V48c0-8.8-7.2-16-16-16zm72 0c-13.3 0-24 10.7-24 24V456c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24H184zm96 0c-13.3 0-24 10.7-24 24V456c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24H280zM448 56V456c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24H472c-13.3 0-24 10.7-24 24zm-64-8V464c0 8.8 7.2 16 16 16s16-7.2 16-16V48c0-8.8-7.2-16-16-16s-16 7.2-16 16z"
            />
        </svg>
        Targeting Regulatory Effect Observations
    </div>
</div>
    <table class="data-table" hx-target="#target-table">
        <tr>
            <th class="chrom-first-end-cap chrom-light-band">Tested Element(s)</th>
            <th class="chrom-dark-band">Effect Size (log2FC)</th>
            <th class="chrom-light-band">Direction</th>
            <th class="chrom-light-band chrom-right-centromere">Significance (p-value)</th>
            <th class="chrom-light-band chrom-left-centromere">Experiment</th>
            <th class="chrom-last-end-cap chrom-dark-band">REO Details</th>
        </tr>
        {% for regeffect in regeffects %}
        {% for re_source in regeffect.sources.all %}
        <tr>
            <td>
                <a href="{% url 'search:dna_features' 'accession' re_source.accession_id %}"
                    >{{ re_source.get_feature_type_display }} @ {{ re_source.chrom_name }}: {{ re_source.location.lower|intcomma }}-{{ re_source.location.upper|intcomma }}</a
                >
            </td>
            {% if forloop.first %}
            <td rowspan="{% firstof regeffect.sources.all|length 1 %}" scope="rowgroup">
                {{ regeffect.effect_size|stringformat:".3e" }}
            </td>
            <td rowspan="{% firstof regeffect.sources.all|length 1 %}" scope="rowgroup">{{ regeffect.direction }}</td>
            <td rowspan="{% firstof regeffect.sources.all|length 1 %}" scope="rowgroup">
                {{ regeffect.significance|stringformat:".3e" }}
            </td>
            <td rowspan="{% firstof regeffect.sources.all|length 1 %}" scope="rowgroup">
                <a href="{% url 'search:experiment' regeffect.experiment.accession_id %}"
                    >{{ regeffect.experiment.name }}</a
                >
            </td>
            <td rowspan="{% firstof regeffect.sources.all|length 1 %}" scope="rowgroup">
                <a href="{% url 'search:reg_effect' regeffect.accession_id %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="svg-link-arrow bi bi-arrow-up-right-square-fill" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707l-4.096 4.096z"/>
                  </svg>
                </a>
            </td>
            {% endif %}
        </tr>
        {% empty %}
        <tr>
            <td>-</td>
            <td>{{ regeffect.effect_size }}</td>
            <td>{{ regeffect.direction }}</td>
            <td>{{ regeffect.significance }}</td>
            <td>
                <a href="{% url 'search:experiment' regeffect.experiment.accession_id %}"
                >{{ regeffect.experiment.name }}</a
                >
            </td>
            <td><a href="{% url 'search:reg_effect' regeffect.accession_id %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="svg-link-arrow bi bi-arrow-up-right-square-fill" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2zM0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm5.854 8.803a.5.5 0 1 1-.708-.707L9.243 6H6.475a.5.5 0 1 1 0-1h3.975a.5.5 0 0 1 .5.5v3.975a.5.5 0 1 1-1 0V6.707l-4.096 4.096z"/>
                </svg>
                </a>
            </td>
        </tr>
        {% endfor %}
        {% endfor %}
    </table>
    <div class="pagination">
        <span class="step-links">
            {% if regeffects.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ regeffects.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ regeffects.number }} of {{ regeffects.paginator.num_pages }}
            </span>

            {% if regeffects.has_next %}
                <a href="?page={{ regeffects.next_page_number }}">next</a>
                <a href="?page={{ regeffects.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>

{% include 'search/v1/partials/_row_click_js.html' %}
